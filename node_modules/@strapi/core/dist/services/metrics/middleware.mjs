function nextResetDate() {
  return Date.now() + 24 * 60 * 60 * 1e3;
}
const createMiddleware = ({ sendEvent }) => {
  const state = {
    expires: nextResetDate(),
    counter: 0
  };
  const middleware = async (ctx, next) => {
    const { url, method } = ctx.request;
    if (!url.includes(".") && ["GET", "PUT", "POST", "DELETE"].includes(method)) {
      if (Date.now() > state.expires) {
        state.expires = nextResetDate();
        state.counter = 0;
      }
      if (state.counter < 1e3) {
        sendEvent("didReceiveRequest", { eventProperties: { url: ctx.request.url } });
        state.counter += 1;
      }
    }
    await next();
  };
  return middleware;
};
export {
  createMiddleware as default
};
//# sourceMappingURL=middleware.mjs.map
